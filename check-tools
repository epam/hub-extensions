#!/bin/sh
# Copyright (c) 2022 EPAM Systems, Inc.
#
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.


while test -n "$1"; do
    case "$1" in
        --omit-optional )
            OMIT_OPTIONAL=1
            ;;
        * )
            echo "Usage: check-tools [--omit-optional]"
    esac
    shift
done

which curl >/dev/null 2>&1 || ./bin/color w "Please install CURL - https://curl.se"
which kubectl >/dev/null 2>&1 || ./bin/color w "Please install KUBECTL - https://kubernetes.io/docs/reference/kubectl/overview/"
which jq >/dev/null 2>&1 || ./bin/color w "Please install JQ - https://stedolan.github.io/jq/"
which yq >/dev/null 2>&1 || ./bin/color w "Please install YQ v4.16 - https://github.com/mikefarah/yq"
if test -z "$OMIT_OPTIONAL"; then
    which npm >/dev/null 2>&1 || ./bin/color w "Please optionally install Node.js and NPM for 'hubctl pull' extension - https://nodejs.org"
    which eksctl >/dev/null 2>&1 || ./bin/color w "Please optionally install EKSCTL for 'hubctl ext eks' extension - https://eksctl.io"
fi
#if ! (which aws >/dev/null 2>&1 || which az >/dev/null 2>&1) ||
if ! which kubectl >/dev/null 2>&1 ||
        ! which yq >/dev/null 2>&1 ||
        ! which jq >/dev/null 2>&1; then
    exit 1
fi

if test "$(jq -V)" \< "jq-1.6"; then
    ./bin/color w "We recommend to update JQ to v1.6 or up - https://stedolan.github.io/jq/"
fi
if test "$(yq --version | awk '{ print $NF }')" \< "4.16"; then
    ./bin/color w "We recommend to update YQ to v4.16.2 or up - https://github.com/mikefarah/yq"
fi
